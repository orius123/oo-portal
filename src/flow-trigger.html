<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<link rel="import" href="inputs-service.html">

<polymer-element name="flow-trigger" attributes="id valid">
  <template>
    <style>
    paper-input {
      width : 100%;
    }
    </style>
    <inputs-service id="{{id}}" res="{{inputs}}"></inputs-service>
    <form>
      <template repeat="{{input in inputs}}">
        <paper-input
          on-input="{{calcFormValidity}}"
          inputValue="{{input.value}}"
          label="{{input.name}}"
          floatingLabel="true"></paper-input>
      </template>
    </form>
  </template>
  <script>
  (function() {

    function isFormValid(inputs) {
      return inputs
        .map(function(el) {
          if (el.mandatory) {
            return el.value != "" && el.value != null && el.value != undefined;
          } else {
            return true;
          }
        }).reduce(function(el, acc) {
          return el && acc;
        }, true);
    }

    Polymer('flow-trigger', {
      inputs : null,
      valid : false,
      inputsChanged : function () {
        this.valid = isFormValid(this.inputs);
        console.log("form "+this.valid);
      },
      calcFormValidity : function() {
        this.valid = isFormValid(this.inputs);
        console.log("form "+this.valid);
      },
      triggerFlow : function() {
        console.log("triggering flow");
      },
      ready : function() {
        this.inputs = [];
      }
    });
  })();
  </script>
</polymer-element>
